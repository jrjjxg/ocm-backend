-- 作业功能调试SQL\n-- 用于检查作业发布和显示相关的数据\n\n-- 1. 检查作业表是否存在及数据状态\nSELECT 'homework表数据检查' as check_type;\nSELECT \n    id,\n    title,\n    course_id,\n    status,\n    CASE status \n        WHEN 1 THEN '草稿'\n        WHEN 2 THEN '已发布'\n        WHEN 3 THEN '已结束'\n        ELSE '未知状态'\n    END as status_desc,\n    start_time,\n    end_time,\n    create_time\nFROM t_homework \nORDER BY course_id, create_time DESC \nLIMIT 20;\n\n-- 2. 检查课程学生关联数据\nSELECT 'course_student表数据检查' as check_type;\nSELECT \n    cs.course_id,\n    c.name as course_name,\n    COUNT(cs.student_id) as student_count\nFROM t_course_student cs\nLEFT JOIN t_course c ON cs.course_id = c.id\nGROUP BY cs.course_id, c.name\nORDER BY cs.course_id;\n\n-- 3. 检查特定课程的作业和学生情况\nSELECT 'course_id=1的作业和学生情况' as check_type;\nSELECT \n    'homework' as type,\n    h.id,\n    h.title,\n    h.status,\n    h.start_time,\n    h.end_time\nFROM t_homework h \nWHERE h.course_id = 1\n\nUNION ALL\n\nSELECT \n    'student' as type,\n    cs.student_id as id,\n    u.real_name as title,\n    NULL as status,\n    NULL as start_time,\n    NULL as end_time\nFROM t_course_student cs\nLEFT JOIN t_user u ON cs.student_id = u.id\nWHERE cs.course_id = 1;\n\n-- 4. 检查作业提交情况\nSELECT 'homework_answer提交情况' as check_type;\nSELECT \n    ha.homework_id,\n    h.title as homework_title,\n    COUNT(ha.student_id) as submitted_count,\n    h.status as homework_status\nFROM t_homework_answer ha\nRIGHT JOIN t_homework h ON ha.homework_id = h.id\nGROUP BY ha.homework_id, h.title, h.status\nORDER BY h.course_id, h.id;\n\n-- 5. 检查数据库表结构是否正确\nSELECT 'table_structure_check' as check_type;\nSELECT \n    TABLE_NAME,\n    CASE WHEN TABLE_NAME IS NOT NULL THEN '✅ 存在' ELSE '❌ 不存在' END as status\nFROM INFORMATION_SCHEMA.TABLES \nWHERE TABLE_SCHEMA = DATABASE() \n    AND TABLE_NAME IN ('t_homework', 't_homework_question', 't_homework_answer', 't_course_student')\nORDER BY TABLE_NAME; 