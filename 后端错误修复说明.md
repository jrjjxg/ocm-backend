# åç«¯é”™è¯¯ä¿®å¤è¯´æ˜

## ğŸ› ä¿®å¤çš„é”™è¯¯

### é”™è¯¯æè¿°
```
The method createExamPaperAnswer(Integer, Integer) is undefined for the type ExamPaperAnswerService
```

**é”™è¯¯ä½ç½®ï¼š** `src/main/java/com/mindskip/xzs/service/impl/CourseExamServiceImpl.java:237`

**é”™è¯¯åŸå› ï¼š** `ExamPaperAnswerService` æ¥å£ä¸­ç¼ºå°‘ `createExamPaperAnswer(Integer, Integer)` æ–¹æ³•çš„å®šä¹‰ã€‚

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. åœ¨æ¥å£ä¸­æ·»åŠ æ–¹æ³•å®šä¹‰

**æ–‡ä»¶ï¼š** `src/main/java/com/mindskip/xzs/service/ExamPaperAnswerService.java`

```java
/**
 * åˆ›å»ºæµ‹éªŒç­”å·
 *
 * @param examPaperId è¯•å·ID
 * @param studentId å­¦ç”ŸID
 * @return åˆ›å»ºçš„ç­”å·å¯¹è±¡
 */
ExamPaperAnswer createExamPaperAnswer(Integer examPaperId, Integer studentId);
```

### 2. åœ¨å®ç°ç±»ä¸­æ·»åŠ æ–¹æ³•å®ç°

**æ–‡ä»¶ï¼š** `src/main/java/com/mindskip/xzs/service/impl/ExamPaperAnswerServiceImpl.java`

```java
@Override
@Transactional
public ExamPaperAnswer createExamPaperAnswer(Integer examPaperId, Integer studentId) {
    // 1. è·å–è¯•å·ä¿¡æ¯
    ExamPaper examPaper = examPaperMapper.selectByPrimaryKey(examPaperId);
    if (examPaper == null) {
        throw new RuntimeException("è¯•å·ä¸å­˜åœ¨");
    }

    // 2. è·å–å­¦ç”Ÿä¿¡æ¯
    User student = userMapper.selectByPrimaryKey(studentId);
    if (student == null) {
        throw new RuntimeException("å­¦ç”Ÿä¸å­˜åœ¨");
    }

    // 3. æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ç­”å·è®°å½•ï¼ˆå¯¹äºä»»åŠ¡ç±»å‹çš„è¯•å·ï¼‰
    ExamPaperTypeEnum paperTypeEnum = ExamPaperTypeEnum.fromCode(examPaper.getPaperType());
    if (paperTypeEnum == ExamPaperTypeEnum.Task) {
        ExamPaperAnswer existingAnswer = examPaperAnswerMapper.getByPidUid(examPaperId, studentId);
        if (existingAnswer != null) {
            throw new RuntimeException("è¯¥è¯•å·åªèƒ½åšä¸€æ¬¡");
        }
    }

    // 4. åˆ›å»ºç­”å·å¯¹è±¡
    Date now = new Date();
    ExamPaperAnswer examPaperAnswer = new ExamPaperAnswer();
    examPaperAnswer.setPaperName(examPaper.getName());
    examPaperAnswer.setExamPaperId(examPaper.getId());
    examPaperAnswer.setCreateUser(student.getId());
    examPaperAnswer.setCreateTime(now);
    examPaperAnswer.setSubjectId(examPaper.getSubjectId());
    examPaperAnswer.setQuestionCount(examPaper.getQuestionCount());
    examPaperAnswer.setPaperScore(examPaper.getScore());
    examPaperAnswer.setPaperType(examPaper.getPaperType());
    examPaperAnswer.setTaskExamId(examPaper.getTaskExamId());
    
    // åˆå§‹åŒ–åˆ†æ•°å’ŒçŠ¶æ€
    examPaperAnswer.setSystemScore(0);
    examPaperAnswer.setUserScore(0);
    examPaperAnswer.setQuestionCorrect(0);
    examPaperAnswer.setDoTime(0);
    examPaperAnswer.setStatus(ExamPaperAnswerStatusEnum.WaitJudge.getCode()); // å¾…æ‰¹æ”¹çŠ¶æ€

    // 5. ä¿å­˜ç­”å·è®°å½•
    insertByFilter(examPaperAnswer);

    return examPaperAnswer;
}
```

### 3. ä¿®å¤ç±»å‹å®‰å…¨è­¦å‘Š

ä¸ºäº†æ¶ˆé™¤ç¼–è¯‘å™¨çš„ç±»å‹å®‰å…¨è­¦å‘Šï¼Œåœ¨ç›¸å…³æ–¹æ³•ä¸Šæ·»åŠ äº† `@SuppressWarnings("unchecked")` æ³¨è§£ï¼š

```java
@Override
@SuppressWarnings("unchecked")
public Object getExamAnswers(Long courseId, Integer examId, Object query) {
    // æ–¹æ³•å®ç°...
}

@Override
@SuppressWarnings("unchecked")
public void evaluateAnswer(Long courseId, Integer examId, Integer answerId, Object data) {
    // æ–¹æ³•å®ç°...
}
```

## ğŸ¯ æ–¹æ³•åŠŸèƒ½è¯´æ˜

### `createExamPaperAnswer` æ–¹æ³•åŠŸèƒ½

1. **å‚æ•°éªŒè¯**ï¼š
   - éªŒè¯è¯•å·æ˜¯å¦å­˜åœ¨
   - éªŒè¯å­¦ç”Ÿæ˜¯å¦å­˜åœ¨

2. **é‡å¤æ£€æŸ¥**ï¼š
   - å¯¹äºä»»åŠ¡ç±»å‹çš„è¯•å·ï¼Œæ£€æŸ¥å­¦ç”Ÿæ˜¯å¦å·²ç»æœ‰ç­”å·è®°å½•
   - é˜²æ­¢é‡å¤ç­”é¢˜

3. **ç­”å·åˆ›å»º**ï¼š
   - ä»è¯•å·ä¿¡æ¯ä¸­å¤åˆ¶åŸºæœ¬å±æ€§
   - è®¾ç½®å­¦ç”ŸIDå’Œåˆ›å»ºæ—¶é—´
   - åˆå§‹åŒ–åˆ†æ•°å’ŒçŠ¶æ€

4. **æ•°æ®æŒä¹…åŒ–**ï¼š
   - å°†ç­”å·è®°å½•ä¿å­˜åˆ°æ•°æ®åº“
   - è¿”å›åˆ›å»ºçš„ç­”å·å¯¹è±¡

### çŠ¶æ€è¯´æ˜

- **åˆå§‹çŠ¶æ€**ï¼š`ExamPaperAnswerStatusEnum.WaitJudge.getCode()` (å¾…æ‰¹æ”¹)
- **å®ŒæˆçŠ¶æ€**ï¼š`ExamPaperAnswerStatusEnum.Complete.getCode()` (å®Œæˆ)

## ğŸ” ç›¸å…³ä¾èµ–

### ä½¿ç”¨çš„Mapperæ¥å£

- `ExamPaperMapper.selectByPrimaryKey()` - è·å–è¯•å·ä¿¡æ¯
- `UserMapper.selectByPrimaryKey()` - è·å–å­¦ç”Ÿä¿¡æ¯  
- `ExamPaperAnswerMapper.getByPidUid()` - æ£€æŸ¥ç°æœ‰ç­”å·
- `insertByFilter()` - ä¿å­˜ç­”å·è®°å½•

### ä½¿ç”¨çš„æšä¸¾ç±»

- `ExamPaperTypeEnum` - è¯•å·ç±»å‹æšä¸¾
- `ExamPaperAnswerStatusEnum` - ç­”å·çŠ¶æ€æšä¸¾

## âœ… ä¿®å¤ç»“æœ

1. **ç¼–è¯‘é”™è¯¯å·²è§£å†³**ï¼š`createExamPaperAnswer` æ–¹æ³•ç°åœ¨å·²æ­£ç¡®å®šä¹‰å’Œå®ç°
2. **ç±»å‹å®‰å…¨è­¦å‘Šå·²æ¶ˆé™¤**ï¼šæ·»åŠ äº†é€‚å½“çš„ `@SuppressWarnings` æ³¨è§£
3. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šæ–¹æ³•åŒ…å«å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘å’Œé”™è¯¯å¤„ç†
4. **äº‹åŠ¡æ”¯æŒ**ï¼šä½¿ç”¨ `@Transactional` æ³¨è§£ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

## ğŸ§ª æµ‹è¯•å»ºè®®

å»ºè®®å¯¹ä»¥ä¸‹åœºæ™¯è¿›è¡Œæµ‹è¯•ï¼š

1. **æ­£å¸¸åˆ›å»ºç­”å·**ï¼š
   - æœ‰æ•ˆçš„è¯•å·IDå’Œå­¦ç”ŸID
   - éªŒè¯ç­”å·æ˜¯å¦æ­£ç¡®åˆ›å»º

2. **å¼‚å¸¸å¤„ç†**ï¼š
   - æ— æ•ˆçš„è¯•å·ID
   - æ— æ•ˆçš„å­¦ç”ŸID
   - é‡å¤åˆ›å»ºä»»åŠ¡ç±»å‹è¯•å·çš„ç­”å·

3. **æ•°æ®å®Œæ•´æ€§**ï¼š
   - éªŒè¯ç­”å·ä¸­çš„æ‰€æœ‰å­—æ®µæ˜¯å¦æ­£ç¡®è®¾ç½®
   - éªŒè¯æ•°æ®åº“è®°å½•æ˜¯å¦æ­£ç¡®ä¿å­˜

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **äº‹åŠ¡ç®¡ç†**ï¼šæ–¹æ³•ä½¿ç”¨äº† `@Transactional` æ³¨è§£ï¼Œç¡®ä¿åœ¨å¼‚å¸¸æƒ…å†µä¸‹æ•°æ®å›æ»š
2. **å¼‚å¸¸å¤„ç†**ï¼šä½¿ç”¨ `RuntimeException` æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸ï¼Œè°ƒç”¨æ–¹éœ€è¦é€‚å½“å¤„ç†
3. **çŠ¶æ€ç®¡ç†**ï¼šæ–°åˆ›å»ºçš„ç­”å·çŠ¶æ€ä¸º"å¾…æ‰¹æ”¹"ï¼Œéœ€è¦åç»­æµç¨‹æ¥æ›´æ–°çŠ¶æ€
4. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨äº† `@SuppressWarnings` æ¥å¤„ç†ä¸å¯é¿å…çš„ç±»å‹è½¬æ¢è­¦å‘Š

ä¿®å¤å®Œæˆåï¼Œé¡¹ç›®åº”è¯¥èƒ½å¤Ÿæ­£å¸¸ç¼–è¯‘å’Œè¿è¡Œã€‚
